# Capacitor Integration for PiiXr Vue Client

## Overview
This project has been successfully integrated with Capacitor to enable native Android APK generation while maintaining all existing web functionality. The integration allows the Vue 3 + TypeScript dashboard to run natively on Android devices with enhanced camera capabilities.

## 🚀 Quick Start

### Prerequisites
- Node.js (v16 or later)
- Android Studio (for APK generation)
- Java Development Kit (JDK 11 or later)

### Build and Run
1. **Build the web application:**
   ```bash
   npm run build
   ```

2. **Sync with Android platform:**
   ```bash
   npx cap sync android
   ```

3. **Open in Android Studio:**
   ```bash
   npx cap open android
   ```

4. **Or use the convenience scripts:**
   - Windows: `build-android.bat`
   - Unix/Linux: `build-android.sh`

## 📱 Native Features Added

### Enhanced Camera Service
- **`CapacitorCameraService.ts`** - Extended camera service that works on both web and native
- **Native photo capture** - High-quality photos using device camera
- **Gallery integration** - Select and process existing photos
- **Automatic fallback** - Uses web camera when native features unavailable

### Mobile Dashboard Enhancements
- **Native detection buttons** - Take photo and select from gallery (visible only in native app)
- **Platform detection** - Automatically adjusts UI based on environment
- **Touch-optimized controls** - Enhanced for mobile interaction

## ⚙️ Configuration

### Capacitor Config (`capacitor.config.ts`)
```typescript
{
  appId: 'com.piixr.vueclient',
  appName: 'PiiXr',
  webDir: 'dist',
  server: {
    androidScheme: 'https'
  },
  plugins: {
    Camera: {
      permissions: ['camera', 'photos']
    }
  }
}
```

### Android Permissions
The following permissions are automatically configured:
- `CAMERA` - For native camera access
- `READ_EXTERNAL_STORAGE` - For gallery access
- `WRITE_EXTERNAL_STORAGE` - For saving captured images
- `INTERNET` - For web functionality

## 🛠️ Development Workflow

### NPM Scripts
- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run build:android` - Build and copy to Android
- `npm run open:android` - Open Android Studio
- `npm run sync:android` - Sync changes with Android

### File Structure
```
├── src/
│   ├── components/
│   │   ├── HomePage.vue (enhanced with native controls)
│   │   ├── MobileDashboard.vue
│   │   └── ...
│   ├── services/
│   │   ├── CameraService.ts (original)
│   │   └── CapacitorCameraService.ts (enhanced)
│   └── types/
│       └── capacitor.d.ts (type definitions)
├── android/ (generated by Capacitor)
├── capacitor.config.ts
└── build-android.{bat,sh}
```

## 🔧 Native vs Web Features

| Feature | Web | Native Android |
|---------|-----|----------------|
| Live camera preview | ✅ | ✅ |
| Object detection overlay | ✅ | ✅ |
| Dashboard navigation | ✅ | ✅ |
| Native photo capture | ❌ | ✅ |
| Gallery integration | ❌ | ✅ |
| Enhanced permissions | ❌ | ✅ |
| Offline capabilities | Limited | ✅ |

## 📦 APK Generation

1. **Build the project:**
   ```bash
   npm run build:android
   ```

2. **Open Android Studio:**
   ```bash
   npx cap open android
   ```

3. **In Android Studio:**
   - Select "Build" → "Generate Signed Bundle / APK"
   - Choose "APK" and follow the signing process
   - The APK will be generated in `android/app/build/outputs/apk/`

## 🔄 Syncing Changes

After making changes to the web application:

1. **Rebuild the web assets:**
   ```bash
   npm run build
   ```

2. **Sync with native platforms:**
   ```bash
   npx cap sync android
   ```

3. **No need to rebuild the Android project** unless native code changes

## 🎯 Integration Benefits

- **Zero breaking changes** - All existing functionality preserved
- **Seamless fallback** - Graceful degradation when native features unavailable
- **Enhanced mobile experience** - Native camera and gallery access
- **Production ready** - Proper permissions and configurations
- **Developer friendly** - Simple build and sync process

## 🐛 Troubleshooting

### Common Issues

**Build fails with "dist directory missing":**
```bash
npm run build
npx cap sync android
```

**Android Studio can't find project:**
- Ensure Android Studio is installed and configured
- Check that JAVA_HOME is set correctly

**Camera permissions denied:**
- Check that permissions are properly declared in AndroidManifest.xml
- Verify that users are prompted for permissions on first use

**Web features not working in native app:**
- Ensure `webDir` points to correct build output (`dist`)
- Check that Capacitor bridge is properly initialized

## 📋 Next Steps

1. **Test on device** - Use `npx cap run android` for device testing
2. **Add app icon** - Replace default icons in `android/app/src/main/res/`
3. **Configure signing** - Set up app signing for Play Store distribution
4. **Add splash screen** - Customize the app launch experience
5. **Optimize build** - Configure ProGuard for release builds

## 🔗 Useful Commands

```bash
# Check Capacitor status
npx cap doctor

# Add iOS platform (if needed later)
npx cap add ios

# Run on connected Android device
npx cap run android

# Live reload during development
npx cap run android --livereload --external
```

The integration is complete and ready for Android APK generation while maintaining full compatibility with the existing Vue 3 dashboard interface!
